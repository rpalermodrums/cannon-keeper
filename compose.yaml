name: canonkeeper

x-workspace-build: &workspace-build
  context: .
  dockerfile: Dockerfile
  target: workspace

x-workspace-env: &workspace-env
  - CANONKEEPER_LLM_API_KEY
  - CANONKEEPER_LLM_BASE_URL
  - CANONKEEPER_LLM_MODEL

services:
  dev:
    image: canonkeeper/dev:local
    build: *workspace-build
    command: ["bun", "run", "dev:container"]
    ports:
      - "5173:5173"
    environment: *workspace-env
  lint:
    image: canonkeeper/lint:local
    build: *workspace-build
    command: ["bun", "run", "lint:local"]
  typecheck:
    image: canonkeeper/typecheck:local
    build: *workspace-build
    command: ["bun", "run", "typecheck:local"]
  test:
    image: canonkeeper/test:local
    build: *workspace-build
    command: ["bun", "run", "test:local"]
  build:
    image: canonkeeper/build:local
    build: *workspace-build
    command: ["bun", "run", "build:local"]
